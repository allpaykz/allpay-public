### Общие принципы метода оплаты при терминальных операциях

При получении первого запроса на пей будет возвращен PENDING. Этот статус означает что все еще необходимо провести все необходимые бизнес-валидации, подготовив транзакцию и заблокировав деньги на счету отправителя.
В этом статусе платеж обычно находится 5-10 секунд. В случае форс-мажорных обстоятельств(кончились деньги на счету отправителя) - платеж можно висеть несколько часов пока администратор не пополнит деньги и не будет проведена повторная попытка обработки. Также в случае необходимости(форс-мажоров) администратор олпей может отменить любые транзакции по которым система еще не ответила статусом завершен(например опять же если нет денег на счету отправителя).
Отмененные транзакции никогда не станут завершенными и завершенными.

Таким образом для проведения платежа агентской системе необходимо повторно слать один и тот же запрос на pay до тех пор пока система олпей не ответит финальным статусом, который может быть успешен, а может быть нет.
Транзакция на стороне олпей не завершится до тех пор пока не ответит статусом "завершено" на запрос pay агентской системы. Например если транзакция прошла все необходимые валидации, но не получит подтверждения со стороны агента(например время жизни запроса в агентской системе истекло из-за долгой обработки при описанных выше форс-мажорных обстоятельствах), то такая транзакция будет продолжать висеть в ожидании повторного запроса или отмены со стороны администратора олпей.

#### Запрос

Во всех операциях ожидается поле с техническим именем RRN - это номер транзакции терминала. Техническое имя поля: rrn, должен быть уникален в разрезе мерчанта. Иными словами rrn + requester(логин в системе олпей созданный под данного агента) - уникальны в системе олпей
Если платеж с парой RRN + requester уже существует в нашей системе - мы возвращаем статус платежа, который уже существует у нас. Если нет - то создает транзакцию в ожидании. Поэтому необходимо повторно запрашивать статус до победного конца.

#### Ответ

В ответе содержится статус ответа и опциональная причина.

Статус может быть один из:

 - fail(+ reason. Причина здесь только для логов. Тут может быть техническое описание и/или хэш стэктрейса и тд. Это не для пользователя) - платеж завершился с ошибкой, деньги не были переведены и статус никогда не изменится по этому платежу по этому GUID’у. Финальный статус
 - pending - нужно повторить платеж еще раз, пока что находится в обработке. Не финальный статус
 - succeeded - платеж завершился, деньги переведены(или скоро будут переведены и доступны), статус тоже не изменится по этому GUID’у. Финальный статус.

В любом другом случае(например не смогли достучаться до нас, или наш балансер вам ответил статус 500 по какой-либо причине) считать что ответ = pending.


### Список доступных операций

Для терминалов существуют следущие АПИ:

- [Пополнение кошелька](TerminalPaymentCashIn.md)
- [Оплата через востокплат](TerminalPaymentVostokPlat.md)
- [Оплата по номеру терминала](TerminalPaymentPayForGoods.md)

